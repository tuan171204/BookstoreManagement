@model BookstoreManagement.Models.Order

<div class="modal-header bg-light">
    <h5 class="modal-title fw-bold">Chi tiết đơn hàng #@Model.OrderId</h5>
    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
</div>

<div class="modal-body">
    <div
        class="alert @(Model.Status == "Completed" ? "alert-success" : (Model.Status == "Cancelled" ? "alert-danger" : (Model.Status == "Approved" ? "alert-info" : (Model.Status == "Shipping" ? "alert-primary" : "alert-warning")))) d-flex align-items-center mb-3">
        <i class="fas @(Model.Status == "Completed" ? "fa-check-circle" : (Model.Status == "Cancelled" ? "fa-times-circle" : "fa-info-circle")) fa-lg me-2"></i>
        <div>
            <strong>Trạng thái:</strong>
            @if (Model.Status == "Pending")
            {
                <span class="text-warning fw-bold">Đang chờ xử lý</span>
            }
            else if (Model.Status == "Approved")
            {
                <span class="text-info fw-bold">Đã duyệt</span>
            }
            else if (Model.Status == "Shipping")
            {
                <span class="text-primary fw-bold">Đang giao hàng</span>
            }
            else if (Model.Status == "Completed")
            {
                <span class="text-success fw-bold">Giao hàng thành công</span>
            }
            else if (Model.Status == "Cancelled")
            {
                <span class="text-danger fw-bold">Đã hủy</span>
            }
        </div>
    </div>

    <h6 class="fw-bold border-bottom pb-2 mb-3">Sản phẩm đã mua</h6>
    @foreach (var item in Model.OrderDetails)
    {
        <div class="d-flex align-items-center mb-3">
            <img src="@item.Book.ImageUrl" onerror="this.src='https://via.placeholder.com/60'" class="rounded border me-3"
                style="width: 50px; height: 70px; object-fit: cover;">

            <div class="flex-grow-1">
                <h6 class="mb-0 small fw-bold">@item.Book.Title</h6>
                <small class="text-muted">@item.Quantity x @item.UnitPrice.ToString("N0") đ</small>
            </div>
            <div class="text-end fw-bold">
                @item.Subtotal.ToString("N0") đ
            </div>
        </div>
    }

    <hr />

    <div class="d-flex justify-content-between mb-1">
        <span class="text-muted">Tổng tiền hàng:</span>
        <span>@Model.TotalAmount.ToString("N0") đ</span>
    </div>

    @if (Model.Promotion != null)
    {
        <div class="d-flex justify-content-between mb-1 text-success">
            <span><i class="fas fa-ticket-alt me-1"></i> Khuyến mãi (@Model.Promotion.Name):</span>
            <span>-@Model.DiscountAmount?.ToString("N0") đ</span>
        </div>
    }

    <div class="d-flex justify-content-between mt-2 pt-2 border-top">
        <span class="fw-bold fs-5">Thành tiền:</span>
        <span class="fw-bold fs-5 text-primary">@Model.FinalAmount.ToString("N0") đ</span>
    </div>

    <div class="mt-2 small text-muted text-end">
        Thanh toán qua: <strong>@Model.PaymentMethod?.Value</strong>
    </div>
</div>

<div class="modal-footer">
    @if (Model.Status == "Pending")
    {
        <button type="button" class="btn btn-outline-danger" onclick="requestCancelOrder(@Model.OrderId)">
            <i class="fas fa-times me-1"></i> Hủy đơn hàng
        </button>
    }
    else if (Model.Status == "Shipping")
    {
        <button type="button" class="btn btn-success" onclick="confirmReceived(@Model.OrderId)">
            <i class="fas fa-check me-1"></i> Xác nhận nhận hàng
        </button>
    }
    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Đóng</button>
</div>